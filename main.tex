% Use the "normalphoto" option if you want a normal photo instead of cropped to a circle
% \documentclass[10pt,a4paper,normalphoto]{altacv}
\documentclass[10pt,a4paper,ragged2e,withhyper]{altacv}
%% AltaCV uses the fontawesome5 and simpleicons packages.
%% See http://texdoc.net/pkg/fontawesome5 and http://texdoc.net/pkg/simpleicons for full list of symbols.

% ====================================== Begin of Modified ======================================
% \geometry{left=1.25cm,right=1.25cm,top=1.5cm,bottom=1.5cm,columnsep=1.2cm}
% \geometry{left=1cm,right=1cm,top=2cm,bottom=1cm,columnsep=1.2cm}
\geometry{left=1cm,right=1cm,top=1cm,bottom=1cm,columnsep=1.2cm}
% ====================================== End of Modified ======================================b

% ====================================== Begin of Added ======================================
\usepackage[activate={true,nocompatibility},final,tracking,protrusion,expansion,factor=1100,stretch=10,shrink=10]{microtype}

\newtoggle{compact}
\toggletrue{compact}  % TODO: Comment out for full CV; Toggle on for compact resume

\newcommand{\cvLink}{https://drive.google.com/file/d/1FlqrJOALCwk4BJMzKuHB7m8pwSVeDU97/view?usp=sharing}
% ====================================== End of Added ======================================

% ====================================== Begin of Modified ======================================
% The paracol package lets you typeset columns of text in parallel
% \usepackage{paracol}
% ====================================== End of Modified ======================================

% Change the font if you want to, depending on whether
% you're using pdflatex or xelatex/lualatex
% WHEN COMPILING WITH XELATEX PLEASE USE
% xelatex -shell-escape -output-driver="xdvipdfmx -z 0" sample.tex
\iftutex
  % If using xelatex or lualatex:
  \setmainfont{Roboto Slab}
  \setsansfont{Lato}
  \renewcommand{\familydefault}{\sfdefault}
\else
  % If using pdflatex:
  \usepackage[rm]{roboto}
  \usepackage[defaultsans]{lato}
  % \usepackage{sourcesanspro}
  \renewcommand{\familydefault}{\sfdefault}
\fi


% ====================================== Begin of Modified ======================================
\definecolor{DarkOrangeShade}{HTML}{331D06}
\definecolor{DarkPinkShade}{HTML}{663145}

\definecolor{GreyOrange}{HTML}{806E66}
\definecolor{GreyOrangePastel}{HTML}{ED9B49}

\definecolor{SlateGrey}{HTML}{2E2E2E}
\definecolor{LightGrey}{HTML}{666666}
\definecolor{GreyMid}{HTML}{5A5A5A}% a mix of the 2 colors above

% \definecolor{DarkPastelRed}{HTML}{450808}
% \definecolor{PastelRed}{HTML}{8F0D0D}
% \definecolor{GoldenEarth}{HTML}{E7D192}

% \colorlet{name}{black}
% \colorlet{tagline}{PastelRed}
% \colorlet{heading}{DarkPastelRed}
% \colorlet{headingrule}{GoldenEarth}
% \colorlet{subheading}{PastelRed}
% \colorlet{accent}{PastelRed}
\colorlet{name}{DarkOrangeShade}
\colorlet{tagline}{DarkPinkShade}
\colorlet{heading}{GreyOrange}
\colorlet{headingrule}{GreyOrangePastel}
\colorlet{subheading}{GreyOrange}
\colorlet{accent}{GreyOrangePastel}

\colorlet{emphasis}{SlateGrey}
\colorlet{body}{LightGrey}

\colorlet{achievement}{GreyMid}
\colorlet{affiliation}{GreyMid}


% Change the markers for the date/location for \cvevent
\renewcommand{\cvDateMarker}{\faCalendar*[regular]}
\renewcommand{\cvLocationMarker}{\faMapMarker*}

% override marker for `itemize`
\renewcommand{\cvItemMarker}{{\raisebox{0.15ex}{\scriptsize\textbullet}}}
\let\itemmarker\cvItemMarker

% \renewcommand{\namefont}{\Huge\rmfamily\bfseries}
\renewcommand{\namefont}{\Huge\bfseries}% use the same default font
% \renewcommand{\personalinfofont}{\footnotesize}
\renewcommand{\personalinfofont}{\footnotesize\bfseries}
% \renewcommand{\cvsectionfont}{\LARGE\rmfamily\bfseries}
\renewcommand{\cvsectionfont}{\large\ltseries}% light as supported by opensans
% \renewcommand{\cvsubsectionfont}{\large\bfseries}
\renewcommand{\cvsubsectionfont}{\normalsize}
% ====================================== End of Modified ======================================


% ====================================== Begin of Added ======================================
\setlength{\parskip}{0pt}%drop new paragraph spacing

\colorlet{link}{emphasis}
% \newcommand{\linked}[3][]{\ifthenelse{\equal{#1}{}}{\textcolor{link}{\href{#3}{\ul{#2}}}}{\href{#3}{#2}}}
\newcommand{\linked}[3][]{%
  \ifthenelse{\equal{#1}{}}{%
    \BeginAccSupp{method=escape,ActualText={\detokenize{#2 (#3)}}}%
      \textcolor{link}{\href{#3}{\ul{#2}}}%
    \EndAccSupp{}%
  }{%
    \BeginAccSupp{method=escape,ActualText={\detokenize{#2 (#3)}}}%
      \href{#3}{#2}%
    \EndAccSupp{}%
  }%
}



\usepackage{calc}
% use `enumitem` to add indentation & reduce top & bottom spacing; note * for appending configs for some defined in altacv
\setlist*{before=\vspace{0pt},after=\vspace{0pt},topsep=0pt,partopsep=0pt,leftmargin=0.5cm}

% for light fonts, taken from https://tex.stackexchange.com/q/176722
\newcommand{\ltseries}{%
   \addfontfeatures{UprightFont={* Light},ItalicFont={* Light Italic}}%
}


% \usepackage[default, type1]{sourcesanspro}
\usepackage[default]{opensans}
\setmainfont{opensans}

% for machine readability/ATS parsing
\input{glyphtounicode}
\pdfgentounicode=1


% set header/footer
\usepackage{fancyhdr}
\usepackage{lastpage}
\setlength\headheight{16pt}
\renewcommand{\headrulewidth}{0.0025pt}
\setlength{\headsep}{16pt}
\setlength{\footskip}{16pt}
\fancypagestyle{titlepage}{%
    \renewcommand{\headrulewidth}{0pt}
    \fancyhead[L]{}
    \fancyhead[R]{}
}%
\fancypagestyle{nontitlepage}{%
    \renewcommand{\headrulewidth}{0pt}
    % \fancyhead[L]{\small Curriculum Vitae}
    % \fancyhead[L]{}
    % \fancyhead[R]{\linked[0]{\small Yuzhao (Stefan) Heng}{https://stefanheng.github.io}}
    % \fancyhead[R]{}
    \fancyfoot[L]{%
        \ifnum\value{page}=\getpagerefnumber{LastPage}%
            \footnotesize Last modified \mydate.%
        \fi%
    }
}%
\fancyhf{}
\fancyfoot[R]{\footnotesize \thepage/\pageref{LastPage}}

\newcommand{\bodyfontsize}{\footnotesize}

% for CV modified date
\usepackage[super]{nth}
\usepackage[short]{datetime}
\newcommand{\mydate}{\shortdayofweekname{\day}{\month}{\year}. \shortmonthname. \nth{\day}, \the\year{}}


% for the skills section
\newcommand{\skillHeader}[1]{\footnotesize\textit{#1}}

% Based on GreyOrangePastel & LightGrey
\definecolor{ThemeGradient01}{HTML}{666666}
\definecolor{ThemeGradient02}{HTML}{7b6462}
\definecolor{ThemeGradient03}{HTML}{93645d}
\definecolor{ThemeGradient04}{HTML}{ac6856}
\definecolor{ThemeGradient05}{HTML}{bf7355}
\definecolor{ThemeGradient06}{HTML}{d08256}
\definecolor{ThemeGradient07}{HTML}{df935a}
\definecolor{ThemeGradient08}{HTML}{eca55f}

\usepackage[inkscapearea=nocrop]{svg}
\usepackage{ifthen}
\def \logoPath {assets/svg/}
\newcommand{\mytagI}[3][]{%
   \ifthenelse{ \equal{#1}{} }
      {\cvtagI{\includesvg[height=2ex]{\logoPath #2}} {#3}}
      \textcolor{#1}{{\cvtagI{\includesvg[height=2ex]{\logoPath #2}} {#3}}}
}
% ====================================== End of Added ======================================

% ====================================== Begin of Modified ======================================
% \input{pubs-authoryear.cfg}
% \input{pubs-num.cfg}
\InputIfFileExists{pubs-authoryear.cfg}{}{}
\addbibresource{main.bib}
\AtBeginBibliography{\bodyfontsize}

% try to align the indentation w/ the rest of bullet lists,
%   as generated by ChatGPT o3-mini-high: https://chatgpt.com/c/67a963d1-03a8-800f-8407-3363c7b1b107
\defbibenvironment{bibliography}
  {
    \vspace*{0.75em}% add space above the bib list for the custom header
    \list
     {
       % the label
       \printtext[labelnumberwidth]{%
         \printfield{labelprefix}%
         \printfield{labelnumber}%
       }
     }
     {
       \setlength{\labelwidth}{\labelnumberwidth}% width of the label
       \setlength{\leftmargin}{\dimexpr\labelnumberwidth+\bibhang\relax+0.25em}%
       \setlength{\itemindent}{-\bibhang}%
       \setlength{\itemsep}{\bibitemsep}%
       \setlength{\parsep}{\bibparsep}%
       \setlength{\bibhang}{1em}
       \setlength{\topsep}{0pt}% space above and below the list
       \setlength{\partopsep}{0pt}% extra space when the list starts a new paragraph
     }
  }
  {\endlist}
  {\item}
% ====================================== End of Modified ======================================



\begin{document}
% ====================================== Begin of Added ======================================
% \vspace*{-2em}
% \vspace*{-3em}
% \vspace*{-4em}
\thispagestyle{titlepage}
\pagestyle{nontitlepage}
\bodyfontsize
\AtBeginEnvironment{itemize}{\bodyfontsize}
% ====================================== End of Added ======================================
\input{sections/header.tex}
%% Depending on your tastes, you may want to make fonts of itemize environments slightly smaller
% \AtBeginEnvironment{itemize}{\small}

% ====================================== Begin of Modified ======================================
% \columnratio{0.6}
% \begin{paracol}{2}
% ====================================== End of Modified ======================================


\vspace*{-0.75em}


\input{sections/education.tex}





\iftoggle{compact}{%
    %
}{
    \vspace{-1em}  % drop weird extra space
}


\vspace*{-0.25em}




\input{sections/work-experience.tex}



\vspace*{-0.25em}



\input{sections/publications.tex}%



\vspace*{-0.25em}



\iftoggle{compact}{%
    \input{sections/skills.tex}% move the skills section up front for there's more space
}{
    \input{sections/keywords.tex}%
}




\pagebreak





\iftoggle{compact}{%
    \input{sections/keywords.tex}
}{
    %
}






\input{sections/research-experience.tex}





\iftoggle{compact}{%
    %
}{
    \vspace{-1em}  % drop weird extra space
}





\iftoggle{compact}{%
    %
}{
    \input{sections/skills.tex}
}





\iftoggle{compact}{}{
    \pagebreak


    \input{sections/teaching.tex}%
}


% ====================================== Begin of Modified ======================================
% \end{paracol}
% ====================================== End of Modified ======================================


\iftoggle{compact}{
    \vfill

    \bodyfontsize
    % \small
    % Last modified \mydate. \par
    Feel free to see my \linked{CV}{\cvLink} for more detailed information. \par
}{
    %
}


\end{document}
